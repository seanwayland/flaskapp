<!DOCTYPE html>
<html>
<head>
    <title>Upload File</title>
    <style>
        body { font-family: sans-serif; }
        #dropBox {
            border: 3px dashed #aaa;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            color: #555;
            cursor: pointer;
            margin-bottom: 20px;
        }
        #dropBox.dragover {
            border-color: #4CAF50;
            background: #f3fff3;
        }
        #progressContainer {
            width: 100%;
            background: #eee;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        #progressBar {
            height: 100%;
            width: 0%;
            background: #4CAF50;
        }
    </style>
</head>
<body>

<h2>Upload a File</h2>

{% if error %}
<p style="color:red">{{ error }}</p>
{% endif %}

{% if success %}
<p style="color:green">{{ success }}</p>
{% endif %}

<div id="dropBox">Drag & drop a file here or click to select</div>

<input type="file" id="fileInput" style="display:none">

<div id="progressContainer">
    <div id="progressBar"></div>
</div>

<script>
    const dropBox = document.getElementById("dropBox");
    const fileInput = document.getElementById("fileInput");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");

    dropBox.onclick = () => fileInput.click();

    dropBox.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropBox.classList.add("dragover");
    });

    dropBox.addEventListener("dragleave", () => {
        dropBox.classList.remove("dragover");
    });

    dropBox.addEventListener("drop", (e) => {
        e.preventDefault();
        dropBox.classList.remove("dragover");
        uploadFile(e.dataTransfer.files[0]);
    });

    fileInput.addEventListener("change", () => {
        uploadFile(fileInput.files[0]);
    });

    function uploadFile(file) {
        if (!file) return;

        let formData = new FormData();
        formData.append("file", file);

        let xhr = new XMLHttpRequest();
        xhr.open("POST", "/upload/form", true);

        xhr.upload.onprogress = function(e) {
            if (e.lengthComputable) {
                let percent = (e.loaded / e.total) * 100;
                progressContainer.style.display = "block";
                progressBar.style.width = percent + "%";
            }
        };

        xhr.onload = function() {
            if (xhr.status == 200) {
                dropBox.innerHTML = "Upload complete!";
                progressBar.style.width = "100%";
            } else {
                dropBox.innerHTML = "Error uploading file.";
            }
        };

        xhr.send(formData);
    }
</script>

<p><a href="/files">View Files</a></p>

</body>
</html>
